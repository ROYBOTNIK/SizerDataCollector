               List of relations
 Schema |        Name        | Type  |  Owner   
--------+--------------------+-------+----------
 public | batches            | table | postgres
 public | calculated_metrics | table | postgres
 public | machine_settings   | table | postgres
 public | machines           | table | postgres
 public | metrics            | table | postgres
(5 rows)

                List of relations
 Schema |         Name         | Type  |  Owner   
--------+----------------------+-------+----------
 oee    | band_definitions     | table | postgres
 oee    | band_statistics      | table | postgres
 oee    | grade_lane_anomalies | table | postgres
 oee    | machine_thresholds   | table | postgres
 oee    | shift_calendar       | table | postgres
(5 rows)

   hypertable_schema   |       hypertable_name       | view_schema |           view_name            | view_owner | materialized_only | compression_enabled | materialization_hypertable_schema | materialization_hypertable_name |                                                                                                                                                                                                                                     view_definition                                                                                                                                                                                                                                     | finalized 
-----------------------+-----------------------------+-------------+--------------------------------+------------+-------------------+---------------------+-----------------------------------+---------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------
 _timescaledb_internal | _materialized_hypertable_10 | oee         | cagg_availability_daily        | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_11     |  SELECT time_bucket('1 day'::interval, minute_ts) AS day,                                                                                                                                                                                                                                                                                                                                                                                                                              +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     serial_no,                                                                                                                                                                                                                                                                                                                                                                                                                                                                         +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     count(*) FILTER (WHERE (state = 2)) AS minutes_run,                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     count(*) FILTER (WHERE (state = 1)) AS minutes_idle,                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     count(*) FILTER (WHERE (state = 0)) AS minutes_down,                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(availability) AS avg_availability                                                                                                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM oee.cagg_availability_minute                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('1 day'::interval, minute_ts)), serial_no;                                                                                                                                                                                                                                                                                                                                                                                                                      | 
 _timescaledb_internal | _materialized_hypertable_13 | oee         | cagg_availability_daily_batch  | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_14     |  SELECT time_bucket('1 day'::interval, minute_ts) AS day,                                                                                                                                                                                                                                                                                                                                                                                                                              +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     serial_no,                                                                                                                                                                                                                                                                                                                                                                                                                                                                         +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     batch_record_id,                                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(lot) AS lot,                                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(variety) AS variety,                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     count(*) FILTER (WHERE (state = 2)) AS minutes_run,                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     count(*) FILTER (WHERE (state = 1)) AS minutes_idle,                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     count(*) FILTER (WHERE (state = 0)) AS minutes_down,                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(availability) AS avg_availability                                                                                                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM oee.cagg_availability_minute_batch                                                                                                                                                                                                                                                                                                                                                                                                                                             +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('1 day'::interval, minute_ts)), serial_no, batch_record_id;                                                                                                                                                                                                                                                                                                                                                                                                     | 
 public                | metrics                     | oee         | cagg_availability_minute       | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_10     |  SELECT time_bucket('00:01:00'::interval, m.ts) AS minute_ts,                                                                                                                                                                                                                                                                                                                                                                                                                          +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     m.serial_no,                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     (oee.avg_int_array((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_rods_pm'::text)))::jsonb))::numeric AS avg_rpm,                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_total_fpm'::text)))::jsonb) AS total_fpm,                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(mt.min_rpm) AS min_rpm,                                                                                                                                                                                                                                                                                                                                                                                                                                                        +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(mt.min_total_fpm) AS min_total_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.availability_state((oee.avg_int_array((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_rods_pm'::text)))::jsonb))::numeric, oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_total_fpm'::text)))::jsonb), min(mt.min_rpm), min(mt.min_total_fpm)) AS state,                                                                                                                                                                                  +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.availability_ratio(oee.availability_state((oee.avg_int_array((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_rods_pm'::text)))::jsonb))::numeric, oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_total_fpm'::text)))::jsonb), min(mt.min_rpm), min(mt.min_total_fpm))) AS availability                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM (metrics m                                                                                                                                                                                                                                                                                                                                                                                                                                                                     +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |      JOIN oee.machine_thresholds mt USING (serial_no))                                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   WHERE (m.metric = ANY (ARRAY['machine_rods_pm'::text, 'machine_total_fpm'::text]))                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('00:01:00'::interval, m.ts)), m.serial_no;                                                                                                                                                                                                                                                                                                                                                                                                                      | 
 public                | metrics                     | oee         | cagg_availability_minute_batch | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_13     |  SELECT time_bucket('00:01:00'::interval, m.ts) AS minute_ts,                                                                                                                                                                                                                                                                                                                                                                                                                          +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     m.serial_no,                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     m.batch_record_id,                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(b.grower_code) AS lot,                                                                                                                                                                                                                                                                                                                                                                                                                                                         +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(b.comments) AS variety,                                                                                                                                                                                                                                                                                                                                                                                                                                                        +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     (oee.avg_int_array((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_rods_pm'::text)))::jsonb))::numeric AS avg_rpm,                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_total_fpm'::text)))::jsonb) AS total_fpm,                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(mt.min_rpm) AS min_rpm,                                                                                                                                                                                                                                                                                                                                                                                                                                                        +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(mt.min_total_fpm) AS min_total_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.availability_state((oee.avg_int_array((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_rods_pm'::text)))::jsonb))::numeric, oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_total_fpm'::text)))::jsonb), min(mt.min_rpm), min(mt.min_total_fpm)) AS state,                                                                                                                                                                                  +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.availability_ratio(oee.availability_state((oee.avg_int_array((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_rods_pm'::text)))::jsonb))::numeric, oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_total_fpm'::text)))::jsonb), min(mt.min_rpm), min(mt.min_total_fpm))) AS availability                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM ((metrics m                                                                                                                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |      JOIN oee.machine_thresholds mt USING (serial_no))                                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |      LEFT JOIN batches b ON ((b.id = m.batch_record_id)))                                                                                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   WHERE (m.metric = ANY (ARRAY['machine_rods_pm'::text, 'machine_total_fpm'::text]))                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('00:01:00'::interval, m.ts)), m.serial_no, m.batch_record_id;                                                                                                                                                                                                                                                                                                                                                                                                   | 
 _timescaledb_internal | _materialized_hypertable_17 | oee         | cagg_grade_daily_batch         | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_18     |  SELECT time_bucket('1 day'::interval, minute_ts) AS day,                                                                                                                                                                                                                                                                                                                                                                                                                              +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     serial_no,                                                                                                                                                                                                                                                                                                                                                                                                                                                                         +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     batch_record_id,                                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(lot) AS lot,                                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(variety) AS variety,                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     sum(good_qty) AS good_qty,                                                                                                                                                                                                                                                                                                                                                                                                                                                         +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     sum(peddler_qty) AS peddler_qty,                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     sum(bad_qty) AS bad_qty,                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     sum(recycle_qty) AS recycle_qty,                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.calc_quality_ratio_qv1(sum(good_qty), sum(peddler_qty), sum(bad_qty), sum(recycle_qty)) AS quality_ratio                                                                                                                                                                                                                                                                                                                                                                       +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM oee.cagg_grade_minute_batch                                                                                                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('1 day'::interval, minute_ts)), serial_no, batch_record_id;                                                                                                                                                                                                                                                                                                                                                                                                     | 
 public                | metrics                     | oee         | cagg_grade_minute_batch        | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_17     |  SELECT time_bucket('00:01:00'::interval, m.ts) AS minute_ts,                                                                                                                                                                                                                                                                                                                                                                                                                          +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     m.serial_no,                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     m.batch_record_id,                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(b.grower_code) AS lot,                                                                                                                                                                                                                                                                                                                                                                                                                                                         +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(b.comments) AS variety,                                                                                                                                                                                                                                                                                                                                                                                                                                                        +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.grade_qty((max((m.value_json)::text) FILTER (WHERE (m.metric = 'lanes_grade_fpm'::text)))::jsonb, 0) AS good_qty,                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.grade_qty((max((m.value_json)::text) FILTER (WHERE (m.metric = 'lanes_grade_fpm'::text)))::jsonb, 1) AS peddler_qty,                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.grade_qty((max((m.value_json)::text) FILTER (WHERE (m.metric = 'lanes_grade_fpm'::text)))::jsonb, 2) AS bad_qty,                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.grade_qty((max((m.value_json)::text) FILTER (WHERE (m.metric = 'lanes_grade_fpm'::text)))::jsonb, 3) AS recycle_qty,                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.calc_quality_ratio_qv1(oee.grade_qty((max((m.value_json)::text) FILTER (WHERE (m.metric = 'lanes_grade_fpm'::text)))::jsonb, 0), oee.grade_qty((max((m.value_json)::text) FILTER (WHERE (m.metric = 'lanes_grade_fpm'::text)))::jsonb, 1), oee.grade_qty((max((m.value_json)::text) FILTER (WHERE (m.metric = 'lanes_grade_fpm'::text)))::jsonb, 2), oee.grade_qty((max((m.value_json)::text) FILTER (WHERE (m.metric = 'lanes_grade_fpm'::text)))::jsonb, 3)) AS quality_ratio+| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM (metrics m                                                                                                                                                                                                                                                                                                                                                                                                                                                                     +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |      LEFT JOIN batches b ON ((b.id = m.batch_record_id)))                                                                                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   WHERE (m.metric = 'lanes_grade_fpm'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('00:01:00'::interval, m.ts)), m.serial_no, m.batch_record_id;                                                                                                                                                                                                                                                                                                                                                                                                   | 
 _timescaledb_internal | _materialized_hypertable_15 | oee         | cagg_throughput_daily_batch    | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_16     |  SELECT time_bucket('1 day'::interval, minute_ts) AS day,                                                                                                                                                                                                                                                                                                                                                                                                                              +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     serial_no,                                                                                                                                                                                                                                                                                                                                                                                                                                                                         +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     batch_record_id,                                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(lot) AS lot,                                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(variety) AS variety,                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(total_fpm) AS total_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                                       +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(missed_fpm) AS missed_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                                     +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(machine_recycle_fpm) AS recycle_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(outlet_recycle_fpm) AS outlet_recycle_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                     +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(combined_recycle_fpm) AS combined_recycle_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(cupfill_pct) AS cupfill_pct,                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(tph) AS tph                                                                                                                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM oee.cagg_throughput_minute_batch                                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('1 day'::interval, minute_ts)), serial_no, batch_record_id;                                                                                                                                                                                                                                                                                                                                                                                                     | 
 public                | metrics                     | oee         | cagg_throughput_minute_batch   | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_15     |  SELECT time_bucket('00:01:00'::interval, m.ts) AS minute_ts,                                                                                                                                                                                                                                                                                                                                                                                                                          +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     m.serial_no,                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     m.batch_record_id,                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(b.grower_code) AS lot,                                                                                                                                                                                                                                                                                                                                                                                                                                                         +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     min(b.comments) AS variety,                                                                                                                                                                                                                                                                                                                                                                                                                                                        +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_total_fpm'::text)))::jsonb) AS total_fpm,                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_missed_fpm'::text)))::jsonb) AS missed_fpm,                                                                                                                                                                                                                                                                                                                                                                  +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_recycle_fpm'::text)))::jsonb) AS machine_recycle_fpm,                                                                                                                                                                                                                                                                                                                                                        +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.outlet_recycle_fpm((max((m.value_json)::text) FILTER (WHERE (m.metric = 'outlets_details'::text)))::jsonb, oee.get_recycle_outlet()) AS outlet_recycle_fpm,                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_cupfill'::text)))::jsonb) AS cupfill_pct,                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_tph'::text)))::jsonb) AS tph,                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     (oee.num((max((m.value_json)::text) FILTER (WHERE (m.metric = 'machine_recycle_fpm'::text)))::jsonb) + oee.outlet_recycle_fpm((max((m.value_json)::text) FILTER (WHERE (m.metric = 'outlets_details'::text)))::jsonb, oee.get_recycle_outlet())) AS combined_recycle_fpm                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM (metrics m                                                                                                                                                                                                                                                                                                                                                                                                                                                                     +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |      LEFT JOIN batches b ON ((b.id = m.batch_record_id)))                                                                                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   WHERE (m.metric = ANY (ARRAY['machine_total_fpm'::text, 'machine_missed_fpm'::text, 'machine_recycle_fpm'::text, 'outlets_details'::text, 'machine_cupfill'::text, 'machine_tph'::text]))                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('00:01:00'::interval, m.ts)), m.serial_no, m.batch_record_id;                                                                                                                                                                                                                                                                                                                                                                                                   | 
 public                | metrics                     | public      | cagg_lane_grade_minute         | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_3      |  SELECT time_bucket('00:01:00'::interval, m.ts) AS minute_ts,                                                                                                                                                                                                                                                                                                                                                                                                                          +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     sum(                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         CASE                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             WHEN (grade_to_cat(g.key) = 0) THEN (g.value)::double precision                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             ELSE NULL::double precision                                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         END) AS good_qty,                                                                                                                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     sum(                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         CASE                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             WHEN (grade_to_cat(g.key) = 1) THEN (g.value)::double precision                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             ELSE NULL::double precision                                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         END) AS peddler_qty,                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     sum(                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         CASE                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             WHEN (grade_to_cat(g.key) = 2) THEN (g.value)::double precision                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             ELSE NULL::double precision                                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         END) AS bad_qty,                                                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     sum(                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         CASE                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             WHEN (grade_to_cat(g.key) = 3) THEN (g.value)::double precision                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             ELSE NULL::double precision                                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         END) AS recycle_qty,                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     calc_quality_ratio_qv1(COALESCE(sum(                                                                                                                                                                                                                                                                                                                                                                                                                                               +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         CASE                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             WHEN (grade_to_cat(g.key) = 0) THEN (g.value)::double precision                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             ELSE NULL::double precision                                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         END), (0)::double precision), COALESCE(sum(                                                                                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         CASE                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             WHEN (grade_to_cat(g.key) = 1) THEN (g.value)::double precision                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             ELSE NULL::double precision                                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         END), (0)::double precision), COALESCE(sum(                                                                                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         CASE                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             WHEN (grade_to_cat(g.key) = 2) THEN (g.value)::double precision                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             ELSE NULL::double precision                                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         END), (0)::double precision), COALESCE(sum(                                                                                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         CASE                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             WHEN (grade_to_cat(g.key) = 3) THEN (g.value)::double precision                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |             ELSE NULL::double precision                                                                                                                                                                                                                                                                                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |         END), (0)::double precision)) AS quality_ratio                                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM ((metrics m                                                                                                                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |      CROSS JOIN LATERAL jsonb_array_elements(m.value_json) lane(lane_json))                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |      CROSS JOIN LATERAL jsonb_each_text(lane.lane_json) g(key, value))                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   WHERE (m.metric = 'lanes_grade_fpm'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('00:01:00'::interval, m.ts));                                                                                                                                                                                                                                                                                                                                                                                                                                   | 
 public                | metrics                     | public      | cagg_lane_size_minute          | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_5      |  SELECT time_bucket('00:01:00'::interval, m.ts) AS minute_ts,                                                                                                                                                                                                                                                                                                                                                                                                                          +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     (lane.ord - 1) AS lane_idx,                                                                                                                                                                                                                                                                                                                                                                                                                                                        +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     sum((v.value)::integer) AS fruit_cnt,                                                                                                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     (sum((((v.value)::integer)::double precision * COALESCE(size_group_value(v.key), (0)::double precision))) / (NULLIF(sum((v.value)::integer), 0))::double precision) AS avg_size                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM ((metrics m                                                                                                                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |      CROSS JOIN LATERAL jsonb_array_elements(m.value_json) WITH ORDINALITY lane(lane_json, ord))                                                                                                                                                                                                                                                                                                                                                                                       +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |      CROSS JOIN LATERAL jsonb_each_text(lane.lane_json) v(key, value))                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   WHERE (m.metric = 'lanes_size_fpm'::text)                                                                                                                                                                                                                                                                                                                                                                                                                                            +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('00:01:00'::interval, m.ts)), (lane.ord - 1);                                                                                                                                                                                                                                                                                                                                                                                                                   | 
 _timescaledb_internal | _materialized_hypertable_8  | public      | cagg_throughput_daily          | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_9      |  SELECT time_bucket('1 day'::interval, minute_ts) AS day,                                                                                                                                                                                                                                                                                                                                                                                                                              +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(total_fpm) AS total_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                                       +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(missed_fpm) AS missed_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                                     +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(machine_recycle_fpm) AS recycle_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(outlet_recycle_fpm) AS outlet_recycle_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                     +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(combined_recycle_fpm) AS combined_recycle_fpm,                                                                                                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(cupfill_pct) AS cupfill_pct,                                                                                                                                                                                                                                                                                                                                                                                                                                                   +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     avg(tph) AS tph                                                                                                                                                                                                                                                                                                                                                                                                                                                                    +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM cagg_throughput_minute                                                                                                                                                                                                                                                                                                                                                                                                                                                         +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('1 day'::interval, minute_ts));                                                                                                                                                                                                                                                                                                                                                                                                                                 | 
 public                | metrics                     | public      | cagg_throughput_minute         | postgres   | t                 | f                   | _timescaledb_internal             | _materialized_hypertable_8      |  SELECT time_bucket('00:01:00'::interval, ts) AS minute_ts,                                                                                                                                                                                                                                                                                                                                                                                                                            +| t
                       |                             |             |                                |            |                   |                     |                                   |                                 |     max((value_json)::double precision) FILTER (WHERE (metric = 'machine_total_fpm'::text)) AS total_fpm,                                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     COALESCE(max((value_json)::double precision) FILTER (WHERE (metric = 'machine_missed_fpm'::text)), (0)::double precision) AS missed_fpm,                                                                                                                                                                                                                                                                                                                                           +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     COALESCE(max((value_json)::double precision) FILTER (WHERE (metric = 'machine_recycle_fpm'::text)), (0)::double precision) AS machine_recycle_fpm,                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     max((value_json)::double precision) FILTER (WHERE (metric = 'machine_cupfill'::text)) AS cupfill_pct,                                                                                                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     max((value_json)::double precision) FILTER (WHERE (metric = 'machine_tph'::text)) AS tph,                                                                                                                                                                                                                                                                                                                                                                                          +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     max(outlet_recycle_fpm(value_json, get_recycle_outlet())) FILTER (WHERE (metric = 'outlets_details'::text)) AS outlet_recycle_fpm,                                                                                                                                                                                                                                                                                                                                                 +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |     (COALESCE(max((value_json)::double precision) FILTER (WHERE (metric = 'machine_recycle_fpm'::text)), (0)::double precision) + COALESCE(max(outlet_recycle_fpm(value_json, get_recycle_outlet())) FILTER (WHERE (metric = 'outlets_details'::text)), (0)::double precision)) AS combined_recycle_fpm                                                                                                                                                                                +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |    FROM metrics m                                                                                                                                                                                                                                                                                                                                                                                                                                                                      +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   WHERE (metric = ANY (ARRAY['machine_total_fpm'::text, 'machine_missed_fpm'::text, 'machine_recycle_fpm'::text, 'machine_cupfill'::text, 'machine_tph'::text, 'outlets_details'::text]))                                                                                                                                                                                                                                                                                              +| 
                       |                             |             |                                |            |                   |                     |                                   |                                 |   GROUP BY (time_bucket('00:01:00'::interval, ts));                                                                                                                                                                                                                                                                                                                                                                                                                                     | 
(12 rows)

 job_id | schedule_interval |      proc_schema       |              proc_name              |                                     config                                      |          next_start           
--------+-------------------+------------------------+-------------------------------------+---------------------------------------------------------------------------------+-------------------------------
      1 | 24:00:00          | _timescaledb_functions | policy_telemetry                    |                                                                                 | 2025-12-21 13:42:54.897025+13
      3 | 1 mon             | _timescaledb_functions | policy_job_stat_history_retention   | {"drop_after": "1 month"}                                                       | 2026-01-01 13:00:00+13
   1000 | 00:01:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "00:00:00", "start_offset": "00:02:00", "mat_hypertable_id": 3}  | 2025-12-21 07:13:41.784045+13
   1001 | 00:01:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "00:00:00", "start_offset": "00:02:00", "mat_hypertable_id": 5}  | 2025-12-21 07:13:40.895758+13
   1003 | 00:01:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "00:00:00", "start_offset": "00:02:00", "mat_hypertable_id": 8}  | 2025-12-21 07:13:42.082226+13
   1004 | 01:00:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "00:00:00", "start_offset": "2 days", "mat_hypertable_id": 9}    | 2025-12-21 07:22:31.145878+13
   1005 | 00:01:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "00:01:00", "start_offset": "02:00:00", "mat_hypertable_id": 10} | 2025-12-21 07:13:41.322929+13
   1006 | 01:00:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "01:00:00", "start_offset": "14 days", "mat_hypertable_id": 11}  | 2025-12-21 07:22:31.220507+13
   1008 | 00:01:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "00:01:00", "start_offset": "02:00:00", "mat_hypertable_id": 13} | 2025-12-21 07:13:41.720188+13
   1009 | 01:00:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "01:00:00", "start_offset": "14 days", "mat_hypertable_id": 14}  | 2025-12-21 07:22:30.653714+13
   1010 | 00:01:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "00:01:00", "start_offset": "02:00:00", "mat_hypertable_id": 15} | 2025-12-21 07:13:41.25601+13
   1011 | 01:00:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "01:00:00", "start_offset": "14 days", "mat_hypertable_id": 16}  | 2025-12-21 07:22:31.01465+13
   1012 | 00:01:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "00:01:00", "start_offset": "02:00:00", "mat_hypertable_id": 17} | 2025-12-21 07:13:42.058023+13
   1013 | 01:00:00          | _timescaledb_functions | policy_refresh_continuous_aggregate | {"end_offset": "01:00:00", "start_offset": "14 days", "mat_hypertable_id": 18}  | 2025-12-21 07:22:30.906968+13
(14 rows)

