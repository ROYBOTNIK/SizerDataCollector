<UserControl x:Class="SizerDataCollector.GUI.WPF.Views.MdfQueryToolView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="720" d:DesignWidth="900">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Margin="12">
            <TextBlock Text="{Binding Title}"
                       FontSize="20"
                       FontWeight="Bold"/>
            <TextBlock Text="{Binding Description}"
                       Foreground="Gray"
                       Margin="0,6,0,0"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1"
                      Margin="12,0,12,12"
                      VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="5*"/>
                </Grid.ColumnDefinitions>
                <GroupBox Grid.ColumnSpan="2" Header="MDF Source" Margin="0,0,0,8">
                    <Grid Margin="8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Source type"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,6"/>
                        <ComboBox Grid.Column="1"
                                  Margin="0,0,0,6"
                                  SelectedItem="{Binding SelectedSourceMode}"
                                  ItemsSource="{Binding SourceModes}"
                                  DisplayMemberPath="DisplayName"/>

                        <TextBlock Grid.Row="1"
                                   Text="Server"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,6"/>
                        <TextBox Grid.Row="1"
                                 Grid.Column="1"
                                 Height="28"
                                 VerticalContentAlignment="Center"
                                 Margin="0,0,0,6"
                                 Text="{Binding ServerName, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock Grid.Row="2"
                                   Text="Database"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,6"/>
                        <TextBox Grid.Row="2"
                                 Grid.Column="1"
                                 Height="28"
                                 VerticalContentAlignment="Center"
                                 Margin="0,0,0,6"
                                 Text="{Binding DatabaseName, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock Grid.Row="3"
                                   Text="MDF path"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <TextBox Grid.Row="3"
                                 Grid.Column="1"
                                 Height="28"
                                 VerticalContentAlignment="Center"
                                 Text="{Binding MdfPath, UpdateSourceTrigger=PropertyChanged}"
                                 IsEnabled="{Binding IsLocalFileMode}"/>
                        <Button Grid.Row="3"
                                Grid.Column="2"
                                Content="Browse"
                                Margin="8,0,0,0"
                                Padding="12,4"
                                Command="{Binding BrowseMdfCommand}"
                                IsEnabled="{Binding IsLocalFileMode}"/>

                        <CheckBox Grid.Row="4"
                                  Content="Use SQL authentication"
                                  Grid.ColumnSpan="2"
                                  IsChecked="{Binding UseSqlAuthentication}"
                                  Margin="0,8,0,0"/>

                        <StackPanel Grid.Row="5"
                                    Grid.ColumnSpan="3"
                                    Orientation="Horizontal"
                                    Margin="0,6,0,0">
                            <TextBlock Text="User"
                                       VerticalAlignment="Center"
                                       Margin="0,0,6,0"/>
                            <TextBox Width="160"
                                     Height="28"
                                     VerticalContentAlignment="Center"
                                     Margin="0,0,12,0"
                                     Text="{Binding UserName, UpdateSourceTrigger=PropertyChanged}"
                                     IsEnabled="{Binding IsSqlAuthEnabled}"/>
                            <TextBlock Text="Password"
                                       VerticalAlignment="Center"
                                       Margin="0,0,6,0"/>
                            <TextBox Width="160"
                                     Height="28"
                                     VerticalContentAlignment="Center"
                                     Text="{Binding Password, UpdateSourceTrigger=PropertyChanged}"
                                     IsEnabled="{Binding IsSqlAuthEnabled}"/>
                            <CheckBox Content="Read-only"
                                      VerticalAlignment="Center"
                                      Margin="16,0,0,0"
                                      IsChecked="{Binding ReadOnly}"/>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <GroupBox Grid.Row="1" Header="Schema Preview" Margin="0,0,8,8">
                    <Grid Margin="8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <Button Content="Load Schema"
                                    Padding="12,4"
                                    Command="{Binding LoadSchemaCommand}"/>
                            <TextBlock Text="{Binding ConnectionSummary}"
                                       Foreground="Gray"
                                       VerticalAlignment="Center"
                                       Margin="12,0,0,0"/>
                        </StackPanel>
                        <ListBox Grid.Row="1"
                                 ItemsSource="{Binding Tables}"
                                 SelectedItem="{Binding SelectedTable}"/>
                    </Grid>
                </GroupBox>

                <GroupBox Grid.Row="1" Grid.Column="1" Header="Query Builder" Margin="0,0,0,8">
                    <Grid Margin="8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Orientation="Horizontal">
                            <Button Content="Generate Query"
                                    Padding="12,4"
                                    Margin="0,0,8,0"
                                    Command="{Binding GenerateQueryCommand}"/>
                            <Button Content="Run Query"
                                    Padding="12,4"
                                    Command="{Binding PreviewQueryCommand}"/>
                        </StackPanel>
                        <TextBlock Grid.Row="1"
                                   Text="Select a table and generate a query template, or edit SQL directly."
                                   Foreground="Gray"
                                   Margin="0,8,0,8"/>
                        <TextBox Grid.Row="2"
                                 AcceptsReturn="True"
                                 AcceptsTab="True"
                                 FontFamily="Consolas"
                                 MinHeight="160"
                                 Text="{Binding QueryText, UpdateSourceTrigger=PropertyChanged}"
                                 IsReadOnly="False"
                                 VerticalScrollBarVisibility="Auto"/>
                    </Grid>
                </GroupBox>

                <GroupBox Grid.Row="2" Grid.ColumnSpan="2" Header="Preview Results" Margin="0,0,0,8">
                    <Grid Margin="8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <Button Content="Export CSV"
                                    Padding="12,4"
                                    Margin="0,0,8,0"
                                    Command="{Binding ExportCsvCommand}"/>
                            <Button Content="Export PDF"
                                    Padding="12,4"
                                    Command="{Binding ExportPdfCommand}"/>
                            <TextBlock Text="{Binding PreviewSummary}"
                                       Foreground="Gray"
                                       VerticalAlignment="Center"
                                       Margin="12,0,0,0"/>
                        </StackPanel>
                        <DataGrid Grid.Row="1"
                                  ItemsSource="{Binding PreviewRows}"
                                  AutoGenerateColumns="True"
                                  IsReadOnly="True"/>
                    </Grid>
                </GroupBox>

                <TextBlock Grid.Row="3"
                           Grid.ColumnSpan="2"
                           Text="{Binding StatusMessage}"
                           Foreground="Gray"/>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
